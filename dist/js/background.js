(()=>{"use strict";var e={266:(e,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.http=void 0,i.http={httpGet:async e=>fetch(e,{method:"get",headers:{"content-type":"application/json"},credentials:"include"}),httpPost:async(e,i)=>fetch(e,{method:"post",body:i,credentials:"include",headers:{"content-type":"application/json"}})}},27:(e,i,t)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.extensionOperation=i.getCurrentTab=i.setConfig=i.getConfig=void 0;const n=t(266),o=t(597);function s(e){chrome.storage.sync.set({chromeConfig:JSON.stringify(e)})}i.getConfig=async function(){let e=await chrome.storage.sync.get(["chromeConfig"]);return JSON.parse(e.chromeConfig)},i.setConfig=s,i.getCurrentTab=async function(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e},i.extensionOperation={userBilibiliInterfaceOnPage:async(e,i)=>{if(i.url.indexOf("bilibili.com")>-1&&e.signIn){let e=await chrome.cookies.get({url:"https://www.bilibili.com",name:"SESSDATA"}),t=await chrome.cookies.get({url:"https://www.bilibili.com",name:"bili_jct"});chrome.scripting.executeScript({target:{tabId:i.id},func:o.script.doUserBilibiliInterface,args:[e.value,t.value]})}},dark:(e,i)=>{i.url.indexOf("bilibili.com")>-1&&e.isDark&&chrome.scripting.insertCSS({files:["dist/css/bilibili_dark_inject.css"],target:{tabId:i.id}})},video:(e,i)=>{i.url.indexOf("bilibili.com/video")>-1&&e.videoImg&&chrome.scripting.executeScript({target:{tabId:i.id},func:o.script.doBilibiliGetImg})},signIn:async e=>{if(e.signInDay!=(new Date).toDateString()&&e.signIn){let t={type:"basic",iconUrl:"../../img/favicon128-128.png",title:"bilibili小插件 by淺い空",message:"已完成B站每日签到！！"};if(null==await chrome.cookies.get({url:"https://www.bilibili.com",name:"SESSDATA"}))t.message="没有登录b站，登陆后才可以使用每日签到哦！！";else{let o=await n.http.httpGet("https://www.bilibili.com"),a=await n.http.httpGet("https://api.live.bilibili.com/xlive/web-ucenter/v1/sign/DoSign");if(o.status>399||a.status>399)t.message="网络错误，每日签到失败了啊！！";else{e.signInDay=(new Date).toDateString();let t=(new Date).getTime(),n=t-(t+288e5)%864e5+864e5,o=setTimeout(i.extensionOperation.signIn,n-t);e.signInDay=o,s(e)}}chrome.notifications.create(null,t)}}}},597:(e,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.script=void 0,i.script={doUserBilibiliInterface:(e,i)=>window.userBilibiliInterface(e,i),doBilibiliGetImg:()=>window.bilibiliGetImg()}}},i={};function t(n){var o=i[n];if(void 0!==o)return o.exports;var s=i[n]={exports:{}};return e[n](s,s.exports,t),s.exports}(()=>{const e=t(27);!async function(){chrome.runtime.onInstalled.addListener((async()=>async function(){console.log("init");let i={isDark:!1,contextMenu:!0,popupSearch:!0,videoImg:!0,signIn:!0,signInDay:"",timeOutId:-1,easyDark:!1};null==(await chrome.storage.sync.get(["chromeConfig"])).chromeConfig&&((new Date).setFullYear(2012),(0,e.setConfig)(i)),chrome.contextMenus.create({id:"bilibili-search-sola",title:"使用bilibili搜索：%s",contexts:["selection"]}),e.extensionOperation.signIn(i)}())),chrome.tabs.onUpdated.addListener(((i,t,n)=>{"complete"==t.status&&async function(i){let t=await(0,e.getConfig)();e.extensionOperation.dark(t,i),e.extensionOperation.userBilibiliInterfaceOnPage(t,i),e.extensionOperation.video(t,i)}(n)})),chrome.omnibox.onInputEntered.addListener((async function(i){let t=await(0,e.getCurrentTab)();chrome.tabs.update(t.id,{url:"https://search.bilibili.com/all?keyword="+i+"&from_source=nav_suggest_new"})})),(await(0,e.getConfig)()).contextMenu&&chrome.contextMenus.onClicked.addListener((function(e,i){"bilibili-search-sola"==e.menuItemId&&chrome.tabs.create({url:"https://search.bilibili.com/all?keyword="+encodeURI(e.selectionText)+"&from_source=nav_suggest_new",active:!0,index:i.index+1})}))}()})()})();