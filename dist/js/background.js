(()=>{"use strict";var e={266:(e,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.http=void 0,i.http={httpGet:async e=>fetch(e,{method:"get",headers:{"content-type":"application/json"},credentials:"include"}),httpPost:async(e,i)=>fetch(e,{method:"post",body:i,credentials:"include",headers:{"content-type":"application/json"}})}},27:(e,i,t)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.extensionOperation=i.getCurrentTab=i.setConfig=i.getConfig=i.defaultConfig=void 0;const n=t(266),a=t(597);async function o(){let e=await chrome.storage.sync.get(["chromeConfig"]);return null==e.chromeConfig?i.defaultConfig:JSON.parse(e.chromeConfig)}function s(e){chrome.storage.sync.set({chromeConfig:JSON.stringify(e)})}i.defaultConfig={isDark:!1,contextMenu:!0,popupSearch:!0,videoImg:!0,signIn:!0,signinAlarm:!1,easyDark:!1},i.getConfig=o,i.setConfig=s,i.getCurrentTab=async function(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e},i.extensionOperation={userBilibiliInterfaceOnPage:async(e,i)=>{if(i.url.indexOf("bilibili.com")>-1&&e.signIn){let e=await chrome.cookies.get({url:"https://www.bilibili.com",name:"SESSDATA"}),t=await chrome.cookies.get({url:"https://www.bilibili.com",name:"bili_jct"});await chrome.scripting.executeScript({target:{tabId:i.id},func:a.script.doUserBilibiliInterface,args:[e.value,t.value]})}},dark:async(e,i)=>{i.url.indexOf("bilibili.com")>-1&&e.isDark&&await chrome.scripting.insertCSS({files:["dist/css/bilibili_dark_inject.css"],target:{tabId:i.id}})},video:async(e,i)=>{i.url.indexOf("bilibili.com/video")>-1&&e.videoImg&&await chrome.scripting.executeScript({target:{tabId:i.id},func:a.script.doBilibiliGetImg})},signIn:async()=>{let e=await o();if(!e.signinAlarm&&e.signIn){let e={type:"basic",iconUrl:"../../img/favicon128-128.png",title:"bilibili小插件 by淺い空",message:"已完成B站每日签到！！"};if(null==await chrome.cookies.get({url:"https://www.bilibili.com",name:"SESSDATA"}))e.message="没有登录b站，登陆后才可以使用每日签到哦！！";else{let t=await n.http.httpGet("https://www.bilibili.com"),a=await n.http.httpGet("https://api.live.bilibili.com/xlive/web-ucenter/v1/sign/DoSign");if(t.status>399||a.status>399)e.message="网络错误，每日签到失败了啊！！";else{let e=(new Date).getTime(),t=e-(e+288e5)%864e5+864e5;chrome.alarms.create("signIn",{delayInMinutes:(t-e)/1e3/60});let n=await o();n.signinAlarm=!0,s(n),chrome.alarms.onAlarm.addListener((async e=>{"signIn"==e.name&&await i.extensionOperation.signIn()}))}}chrome.notifications.create(null,e)}}}},597:(e,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.script=void 0,i.script={doUserBilibiliInterface:(e,i)=>window.userBilibiliInterface(e,i),doBilibiliGetImg:()=>window.bilibiliGetImg()}}},i={};function t(n){var a=i[n];if(void 0!==a)return a.exports;var o=i[n]={exports:{}};return e[n](o,o.exports,t),o.exports}(()=>{const e=t(27);!async function(){chrome.runtime.onInstalled.addListener((async()=>async function(){if(console.log("init"),void 0===(await chrome.storage.sync.get(["chromeConfig"])).chromeConfig){let i=e.defaultConfig,t=new Date;t.setFullYear(2012),i.signInDay=t.toDateString(),(0,e.setConfig)(i)}chrome.contextMenus.create({id:"bilibili-search-sola",title:"使用bilibili搜索：%s",contexts:["selection"]})}())),await e.extensionOperation.signIn(),chrome.tabs.onUpdated.addListener((async(i,t,n)=>{"complete"==t.status&&await async function(i){let t=await(0,e.getConfig)();await e.extensionOperation.dark(t,i),await e.extensionOperation.userBilibiliInterfaceOnPage(t,i),await e.extensionOperation.video(t,i)}(n)})),chrome.omnibox.onInputEntered.addListener((async function(i){let t=await(0,e.getCurrentTab)();await chrome.tabs.update(t.id,{url:"https://search.bilibili.com/all?keyword="+i+"&from_source=nav_suggest_new"})})),async function(){(await(0,e.getConfig)()).contextMenu&&chrome.contextMenus.onClicked.addListener((async function(e,i){"bilibili-search-sola"==e.menuItemId&&await chrome.tabs.create({url:"https://search.bilibili.com/all?keyword="+encodeURI(e.selectionText)+"&from_source=nav_suggest_new",active:!0,index:i.index+1})}))}()}()})()})();